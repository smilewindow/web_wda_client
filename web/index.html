<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WDA Web 控制台</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="hud">
    <span class="pill" id="hud-api">API: <code class="muted"></code></span>
    <span class="pill" id="hud-size">—</span>
  </div>

  <div id="wrap">
    <div id="phone">
      <img id="stream" alt="iPhone Stream" />
      <iframe id="webrtc" title="WebRTC Stream" allow="autoplay; fullscreen; picture-in-picture"></iframe>
      <canvas id="overlay"></canvas>
      <div class="cursor" id="cursor"></div>
    </div>
  </div>

  <div id="toolbar">
    <button class="btn" id="btn-home">Home</button>
    <button class="btn" id="btn-lock">Lock</button>
    <button class="btn" id="btn-vol-up">Vol +</button>
    <button class="btn" id="btn-vol-down">Vol −</button>
    <button class="btn" id="btn-reload">重载</button>
    <button class="btn" id="btn-appium">Appium 设置</button>
  </div>

  <button id="gest-toggle">手势日志</button>
  <div id="gest-panel">
    <header>
      <label><input type="checkbox" id="gest-debug"/> 调试日志</label>
      <label><input type="checkbox" id="gest-dryrun"/> 仅日志（不发送）</label>
      <div class="row">
        <!-- 长按阈值设置已移除，固定为 500ms -->
      </div>
      <div class="row">
        <label for="gest-intensity" class="muted">甩动力度</label>
        <select id="gest-intensity" style="padding:4px 6px;border:1px solid var(--line);border-radius:8px;background:#0f0f12;color:var(--fg)">
          <option value="light">轻</option>
          <option value="medium">中</option>
          <option value="strong">强</option>
        </select>
      </div>
      <div class="row">
        <label for="gest-scroll-mode" class="muted">滚动方案</label>
        <select id="gest-scroll-mode" style="padding:4px 6px;border:1px solid var(--line);border-radius:8px;background:#0f0f12;color:var(--fg)">
          <option value="velocity">速度拖拽（mobile: dragFromToWithVelocity）</option>
          <option value="w3c">W3C Actions（轨迹回放）</option>
        </select>
      </div>
      <!-- 移除 press 持续时间设置，交由算法自适应 -->
      <button id="gest-close" class="btn">关闭</button>
    </header>
    <div class="body">
      <div class="g-section">
        <div class="g-sec-head"><h3 style="margin:6px 0 4px 2px">事件日志</h3><button id="gest-clear" class="btn">清空</button></div>
        <div id="gest-log"></div>
      </div>
    </div>
  </div>

  <div id="appium-panel">
    <h4>流源与 Appium 设置</h4>
    <div class="row">
      <label style="width:74px">流源</label>
      <select id="stream-mode" style="padding:4px 6px;border:1px solid var(--line);border-radius:8px;background:#0f0f12;color:var(--fg)">
        <option value="mjpeg">MJPEG（后端 /stream）</option>
        <option value="webrtc">WebRTC（自建推流）</option>
      </select>
    </div>
    <div class="row">
      <label style="width:74px">WebRTC</label>
      <input type="text" id="webrtc-url" placeholder="http://127.0.0.1:8889/iphone1"/>
      <label style="font-size:12px;opacity:.85"><input type="checkbox" id="webrtc-opts" checked /> 自动追加参数</label>
      <button class="btn" id="stream-apply">应用流源</button>
    </div>
    <div class="row">
      <label style="width:74px">缩放%</label>
      <input type="range" min="50" max="200" step="5" id="view-zoom"/>
      <span class="val" id="view-zoom-val"></span>
    </div>
    <hr style="border:none;border-top:1px solid var(--line);opacity:.6;margin:8px 0"/>
    <h4 style="margin-top:0">Appium MJPEG 设置</h4>
    <div class="row">
      <label style="width:74px">Base</label>
      <input type="text" id="ap-base" placeholder="http://127.0.0.1:4723"/>
    </div>
    <div class="row">
      <label style="width:74px">Session</label>
      <input type="text" id="ap-sid" placeholder="<Appium SessionId>"/>
    </div>
    <div class="row">
      <label style="width:74px">UDID</label>
      <input type="text" id="ap-udid" placeholder="<Device UDID for create>"/>
    </div>
    <div class="row">
      <label style="width:74px">缩放%</label>
      <input type="range" min="30" max="100" step="1" id="ap-scale"/>
      <span class="val" id="ap-scale-val"></span>
    </div>
    <div class="row">
      <label style="width:74px">帧率</label>
      <input type="range" min="1" max="60" step="1" id="ap-fps"/>
      <span class="val" id="ap-fps-val"></span>
    </div>
    <div class="row">
      <label style="width:74px">质量</label>
      <input type="range" min="5" max="50" step="1" id="ap-quality"/>
      <span class="val" id="ap-quality-val"></span>
    </div>
    
    <!-- 手势通道选择已移除：前端固定走 Appium 通道 -->
    <!-- 保活设置移除，默认总是保活（见脚本） -->

    <div class="row" style="justify-content:flex-end;gap:10px;flex-wrap:wrap">
      <button class="btn" id="ap-fetch">获取会话</button>
      <button class="btn" id="ap-create">创建会话</button>
      <button class="btn" id="ap-load">读取设置</button>
      <button class="btn" id="ap-optimize">WDA 优化</button>
      <button class="btn" id="ap-apply">应用</button>
      <button class="btn" id="ap-close">关闭</button>
    </div>
    <div class="row" style="font-size:12px;opacity:.8">提示：需使用 Appium 的会话 ID；若有 base 变更，请在此填写。</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js" defer></script>
  <script src="gesture-request.js" defer></script>
  <script src="gesture-recognizer.js" defer></script>
  <script src="app.js" defer></script>
</body>
</html>
